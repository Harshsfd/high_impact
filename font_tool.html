<!DOCTYPE html>
<html>
<head>
    <title>Font Tool</title>
    <style>
        /* General Styles */
        * {
            box-sizing: border-box;
        }

        body {
            color: #333;
            background-color: #fff;
            font-family: sans-serif;
            padding: 32px;
            font-size: 10pt;
            max-width: 1092px;
            margin: 32px auto 256px auto;
            line-height: 1.4;
        }

        input, select {
            margin-right: 16px;
            background-color: #eee;
            color: #333;
            border: 0;
            padding: 4px 6px;
            font-size: 10pt;
        }

        pre, code {
            padding: 4px 2px;
        }

        div.section {
            display: none;
        }

        p#preview {
            font-size: 28px;
        }

        textarea {
            width: 100%;
            height: 128px;
        }

        a { 
            color: #fa0;
        }

        h1, h2, h3 {
            font-weight: normal;
            text-transform: uppercase;
        }

        h1 {
            text-transform: none;
            font-size: 34px;
            margin: 32px 0;
        }

        h2 {
            margin-top: 64px;
        }

        h3 {
            margin-top: 32px;
        }

        #form {
            padding-bottom: 2em;
            line-height: 2;
        }

        textarea.example {
            display: none;
        }

        .box {
            width: 512px;
            float: left;
        }

        .box:first-child { 
            margin-right: 4px;
        }

        canvas {
            background-color: #333;
            -webkit-font-smoothing: antialiased;
        }

        #glyph-canvas {
            max-width: 512px;
            max-height: 512px;
        }

        input[type=button] {
            background-color: #fa0;
            color: #fff;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 12px;
            padding: 8px 64px;
        }

        input#size {
            width: 38px;
        }

        input[disabled] {
            background-color: #555;
            color: #aaa;
        }
    </style>
</head>
<body>

<h1>Font Tool</h1>

<!-- Font Face Declaration Section -->
<div class="section" id="section-font-face-declaration">
    <h2>CSS @font-face Declaration</h2>
    <p><em>You can load any CSS for a Web-Font here (<a href="https://www.google.com/fonts">Google Fonts</a> is a good source), or just specify a locally installed font with the <code>src: local("name");</code> rule.</em></p>
    <p>Generate @font-face from a local ttf/woff file: <input type="file" id="font-local-file"/></p>
    <div><textarea spellcheck="false" id="font-face-css"></textarea></div>
    <p><input type="button" value="Load @font-face" id="load-css"/></p>
</div>

<!-- Font Preview Section -->
<div class="section" id="section-selected-font-preview">
    <h2><span id="font-name"></span> Preview</h2>
    <p id="preview" contentEditable="true">The five boxing wizards jump quickly. 0123456789!?</p>
</div>

<!-- Generator Settings Section -->
<div class="section" id="section-generator-settings">
    <h2>Generator Settings</h2>
    <p>
        Font Style: <select id="font-style">
            <option value="">Normal</option>
            <option value="bold">Bold</option>
            <option value="italic">Italic</option>
            <option value="italic bold">Bold Italic</option>
        </select>
        Size: <input type="number" id="font-size" value="14"/>
        Range: <select id="character-range">
            <option value="127" selected>ASCII only</option>
            <option value="255">Full Latin-1</option>
        </select>
        Spacing: <select id="font-spacing">
            <option value="proportional" selected>Proportional</option>
            <option value="monospace-numbers">Force monospaced numbers</option>
            <option value="monospace-all">Force monospaced all</option>
        </select>
    </p>
    <p>
        Rendering: <select id="render-type">
            <option value="Bitmap">Antialiased</option>
            <option value="Pixel">Pixelated</option>
        </select>
        Output width: <select id="output-width">
            <option value="64">64</option>
            <option value="128">128</option>
            <option value="256" selected>256</option>
            <option value="512">512</option>
            <option value="1024">1024</option>
        </select>
    </p>
    <p style="clear:both;"><em class="render-type-setting render-type-setting-Pixel">Note: Antialiasing can not be disabled in all browsers. Typically Firefox/Windows does a good job with Pixel fonts, regardless of Antialias, if rendered in the correct size. Chrome/OSX lets us specifically disable Antialiasing and is thus the preferred choice.</em></p>
    <p>
        Glyph draw function:
        <select id="glyph-draw-preset">
            <option value="glyph-draw-default">Default</option>
            <option value="glyph-draw-gradient">Gradient</option>
            <option value="glyph-draw-outline">Outline</option>
        </select>
    </p>
    <p>
        <textarea spellcheck="false" id="glyph-draw-function">ctx.fillText(glyph, x, y);</textarea>
        <textarea id="glyph-draw-default" class="example">ctx.fillText(glyph, x, y);</textarea>
        <textarea id="glyph-draw-gradient" class="example">let height = ctx.canvas.height; let gradient = ctx.createLinearGradient(0, height*0.25, 0, height*0.75); gradient.addColorStop("0","#FF92CE"); gradient.addColorStop("1.0","#6736FF"); ctx.fillStyle = gradient; ctx.fillText(glyph, x, y);</textarea>
        <textarea id="glyph-draw-outline" class="example">ctx.strokeStyle = 'red'; ctx.lineWidth = 2; ctx.strokeText(glyph, x, y); ctx.fillStyle = 'white'; ctx.fillText(glyph, x, y);</textarea>
    </p>
    <p><input type="button" value="Generate" id="generate"/></p>
</div>

<!-- Intermediate Output Section -->
<div class="section" id="section-intermediate-output">
    <div class="box">
        <h2>Current Glyph</h2>
        <canvas id="glyph-canvas" width="512" height="512"></canvas>
    </div>
    <div class="box">
        <h2>Result</h2>
        <canvas id="output-canvas" width="512" height="512"></canvas>
    </div>
    <div style="clear:both"></div>
</div>

<!-- Generated Font Section -->
<div class="section" id="section-generated-font">
    <h2>Generated Font</h2>
    <div class="box">
        <h3>Glyph image as PNG, metrics as JSON</h3>
        <p><a id="font-download-image" href="#">font_<span class="font-file-name">arial</span>.png</a> – glyph image (Save as <code>assets/font_<span class="font-file-name">arial</span>.png</code>)</p>
        <p><a id="font-download-definition" href="#">font_<span class="font-file-name">arial</span>.json</a> – font definition (Save as <code>assets/font_<span class="font-file-name">arial</span>.json</code>)</p>
    </div>
    <div class="box">
        <h3>Usage</h3>
        <p id="font-info"><pre><code>font_t *font = font("assets/font_<span class="font-file-name">arial</span>.qoi", "assets/font_<span class="font-file-name">arial</span>.json");</code></pre></p>
    </div>
    <div style="clear:both"></div>
</div>

<script>
"use strict";

// -----------------------------------------------------------------------------
// Bitmap Fonts

var FontBitmap = function(outputCanvas, glyphCanvas, fontName, fontStyle, fontSize, spacing, drawFunction) {
    this.outputCanvas = outputCanvas;
    this.outputCtx = this.outputCanvas.getContext('2d');

    this.glyphCanvas = glyphCanvas;
    this.glyphCtx = this.glyphCanvas.getContext('2d');

    this.outputCanvas.style.imageRendering = 'auto';
    this.glyphCanvas.style.imageRendering = 'auto';

    this.fontName = fontName;
    this.fontStyle = fontStyle;
    this.fontSize = fontSize;
    this.spacing = spacing;
    this.drawFunction = drawFunction;
};

// Methods for FontBitmap class
FontBitmap.prototype.setFont = function() {
    this.glyphCtx.font = this.fontStyle + " " + this.fontSize + "px " + this.fontName;
};

FontBitmap.prototype.drawGlyph = function(glyph) {
    this.glyphCtx.clearRect(0, 0, this.glyphCanvas.width, this.glyphCanvas.height);
    this.glyphCtx.font = this.fontStyle + " " + this.fontSize + "px " + this.fontName;
    this.glyphCtx.fillText(glyph, 0, this.fontSize);
};

FontBitmap.prototype.render = function() {
    // Placeholder for render function
};

// -----------------------------------------------------------------------------
// Pixel Fonts

var FontBitmapPixel = function(outputCanvas, glyphCanvas, fontName, fontStyle, fontSize, spacing, drawFunction) {
    FontBitmap.call(this, outputCanvas, glyphCanvas, fontName, fontStyle, fontSize, spacing, drawFunction);
};

FontBitmapPixel.prototype = Object.create(FontBitmap.prototype);
FontBitmapPixel.prototype.constructor = FontBitmapPixel;

FontBitmapPixel.prototype.render = function() {
    this.outputCtx.clearRect(0, 0, this.outputCanvas.width, this.outputCanvas.height);
    this.outputCtx.drawImage(this.glyphCanvas, 0, 0);
};

// -----------------------------------------------------------------------------
// Font Tool

var FontTool = function() {
    this.fontName = 'Arial';
    this.fontStyle = '';
    this.fontSize = 14;
    this.spacing = 'proportional';
    this.drawFunction = 'ctx.fillText(glyph, x, y);';
    this.fontTool = this;

    this.init();
};

// Initialize FontTool
FontTool.prototype.init = function() {
    var self = this;

    // Elements
    this.fontFaceCSS = document.getElementById('font-face-css');
    this.fontNameEl = document.getElementById('font-name');
    this.previewEl = document.getElementById('preview');
    this.generateButton = document.getElementById('generate');
    this.fontLocalFile = document.getElementById('font-local-file');

    // Event Listeners
    document.getElementById('load-css').addEventListener('click', function() {
        self.loadCSS(self.fontFaceCSS.value);
    });

    this.generateButton.addEventListener('click', function() {
        self.generateFont();
    });

    this.fontLocalFile.addEventListener('change', function(e) {
        self.loadLocalFont(e.target.files[0]);
    });
};

// Load local font
FontTool.prototype.loadLocalFont = function(file) {
    var reader = new FileReader();
    reader.onload = function(e) {
        var fontFace = new FontFace('local-font', e.target.result);
        fontFace.load().then(function(font) {
            document.fonts.add(font);
            self.updatePreview();
        });
    };
    reader.readAsArrayBuffer(file);
};

// Load CSS for font face
FontTool.prototype.loadCSS = function(css) {
    var style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
    this.updatePreview();
};

// Update preview text
FontTool.prototype.updatePreview = function() {
    this.previewEl.style.fontFamily = this.fontName;
    this.previewEl.style.fontStyle = this.fontStyle;
    this.previewEl.style.fontSize = this.fontSize + 'px';
};

// Generate font
FontTool.prototype.generateFont = function() {
    var outputCanvas = document.getElementById('output-canvas');
    var glyphCanvas = document.getElementById('glyph-canvas');
    var fontTool = new FontBitmapPixel(outputCanvas, glyphCanvas, this.fontName, this.fontStyle, this.fontSize, this.spacing, this.drawFunction);
    fontTool.render();
    // Additional logic to handle font generation output
};

// Initialize Font Tool
var fontTool = new FontTool();

</script>

</body>
</html>
